# 02_DockerNext — навчальний матеріал з Dockerfile для Next.js

Автор: ItStep, Oleksandr Nykytin  
Оновлено: 2025-08-27

Цей репозиторій є навчальним прикладом, що демонструє, як створювати Docker-образи для Next.js застосунку двома способами:
- Контейнер для розробки (development) — швидкий старт з hot-reload.
- Контейнер для продакшну (production) — попередня збірка та запуск оптимізованої версії.

У каталозі присутні два окремі Dockerfile:
- Dockerfile_dev — для локальної розробки.
- Dockerfile_prod — для продакшн-сценаріїв.

Фронтенд застосунок розміщено в папці frontend/ (Next.js).

## Передумови
- Встановлений Docker (та, за бажанням, Docker Compose).
- Вільний порт 3000 на вашій машині (за замовчуванням Next.js працює на 3000).

## Що мався на увазі поділ на два типи контейнерів
Ідея полягає в тому, що ми маємо два різні робочі процеси:

1) Development-контейнер
- Призначення: зручна локальна розробка.
- Команда запуску: `yarn dev`.
- Переваги: швидкий старт, автооновлення при зміні коду (hot reload / HMR).
- Недолік: повільніший старт/робота у порівнянні з оптимізованим продом, більший образ.

2) Production-контейнер
- Призначення: запуск оптимізованої збірки на сервері/у продакшні.
- На етапі збірки виконується `yarn build`, на етапі запуску — `yarn start`.
- Переваги: оптимізований розмір та продуктивність, швидший старт у рантаймі.
- Недолік: без hot-reload; для змін необхідно пересобирати образ.

## Структура
- frontend/ — код Next.js застосунку (app/, public/, package.json тощо).
- Dockerfile_dev — інструкції для dev-режиму.
- Dockerfile_prod — інструкції для prod-режиму.

## Запуск варіанта для розробки (Dockerfile_dev)
З кореня каталогу 02_DockerNext виконайте:

1. Зібрати образ (позначимо тегом next-dev):
   docker build -f Dockerfile_dev -t next-dev .

2. Запустити контейнер з пробросом порту 3000:
   docker run --rm -it -p 3000:3000 next-dev

Після запуску відкрийте у браузері: http://localhost:3000

Підказки:
- За потреби можна підключити volume для live-редагування коду з хоста всередину контейнера (опціонально):
  docker run --rm -it -p 3000:3000 -v "$(pwd)/frontend:/app" next-dev
  Зверніть увагу: залежно від ОС синтаксис шляху може відрізнятися.

## Запуск продакшн-варіанту (Dockerfile_prod)
З кореня каталогу 02_DockerNext виконайте:

1. Зібрати образ (позначимо тегом next-prod):
   docker build -f Dockerfile_prod -t next-prod .

2. Запустити контейнер з пробросом порту 3000:
   docker run --rm -it -p 3000:3000 next-prod

Після запуску відкрийте у браузері: http://localhost:3000

## Нотатки щодо Dockerfile
- Обидва образи базуються на Node.js 22 (для prod — варіант alpine). 
- Використовується робоча директорія /app всередині контейнера.
- Спочатку копіюються файли залежностей (package*.json) для кращого кешування шарів, потім встановлюються залежності, а вже потім — увесь код.
- У dev-варіанті контейнер запускає `yarn dev` (HMR).
- У prod-варіанті під час збірки виконується `yarn build`, а старт — через `yarn start`.
- Порт 3000 відкривається директивою EXPOSE (для документації). Реальний проброс робиться через параметр `-p` при запуску.

## Типові проблеми та поради
- Контекст збірки: команда `docker build` запускається з кореня 02_DockerNext, бо Dockerfile очікують шлях `frontend/...`.
- Кеш: після змін у package.json залежності будуть перевстановлені; незмінний package.json пришвидшує збірку завдяки кешу.
- .dockerignore: перевіряйте .dockerignore (якщо є), щоб не копіювати зайві файли в образ.
- Порти/фаєрвол: переконайтеся, що порт 3000 вільний і не блокується системою безпеки.

## Автор
- ItStep
- Oleksandr Nykytin
